<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voice Test — Latin & Greek</title>
  <style>
    body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#f8fafc;padding:24px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 20px rgba(2,6,23,0.06);max-width:900px;margin:auto}
    .voice{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px dashed #eee}
    .voice:last-child{border-bottom:0}
    button{padding:8px 10px;border-radius:8px;border:0;background:#4f46e5;color:#fff;cursor:pointer}
    .small{color:#6b7280;font-size:13px}
  </style>
</head>
<body>
    <div class="card">
    <h1>Voice Test — Latin & Greek</h1>
    <p class="small">This page enumerates the browser's SpeechSynthesis voices and lets you play short samples. Use the controls to test voices per language.</p>

    <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap">
      <label class="small">Language:</label>
      <select id="langSel">
        <option value="la">Latin (la)</option>
        <option value="el">Ancient Greek (el)</option>
        <option value="it">Italian (it)</option>
        <option value="en">English (en)</option>
        <option value="fr">French (fr)</option>
        <option value="de">German (de)</option>
        <option value="es">Spanish (es)</option>
      </select>
      <label class="small">Voice:</label>
      <select id="voiceSel" style="min-width:240px"></select>
      <button id="playVoice" class="btn">Play Sample</button>
      <button id="playAll" class="btn">Play All Voices For Language</button>
      <button id="stopAll" style="background:#ef4444;color:#fff;padding:8px;border-radius:8px;border:0">Stop</button>
    </div>

    <div id="voicesWrap"></div>
    <div style="margin-top:12px" class="small">Notes: voice availability depends on OS/browser. Use Chrome/Edge for best voice selection.</div>
  </div>

  <script>
    const samples = {
      latin: 'Salve discipule. Quomodo vales? Ego laetus sum te docere.',
      greek: 'Χαῖρε μαθητὴ. Πῶς ἔχεις; Εὐδαίμων εἰμί ὅτι μανθάνεις.'
    };

    function matchVoiceToLang(v, code){
      if(!v || !v.lang) return false;
      // treat Latin (la) as Italian (it) for browser voice matching
      const map = { la: 'it' };
      const c = map[code] || code;
      return v.lang.toLowerCase().startsWith(c.toLowerCase());
    }

    let _voicesCache = [];
    function buildVoiceOptionText(vo){ return vo.name + ' — ' + vo.lang + (vo.default ? ' (default)' : ''); }

    function populateVoiceSelectForLang(code){
      const sel = document.getElementById('voiceSel'); sel.innerHTML = '';
      const v = _voicesCache || [];
      const map = { la: 'it' };
      const c = map[code] || code;
      v.forEach((vo,i)=>{
        if(vo.lang && vo.lang.toLowerCase().startsWith(c.toLowerCase())){
          const opt = document.createElement('option'); opt.value = i; opt.textContent = buildVoiceOptionText(vo);
          sel.appendChild(opt);
        }
      });
      if(sel.options.length===0){ const opt = document.createElement('option'); opt.value = -1; opt.textContent = 'No matching voices'; sel.appendChild(opt); }
    }

    function loadVoices(){
      _voicesCache = speechSynthesis.getVoices() || [];
      const wrap = document.getElementById('voicesWrap');
      wrap.innerHTML = '';
      if(_voicesCache.length===0){ wrap.innerHTML = '<div class="small">No voices available — try refreshing or using a different browser.</div>'; return; }
      _voicesCache.forEach((vo, i)=>{
        const div = document.createElement('div'); div.className='voice';
        const info = document.createElement('div'); info.innerHTML = '<strong>'+vo.name+'</strong> — '+vo.lang + (vo.default ? ' (default)' : '');
        const controls = document.createElement('div');
        const playBtn = document.createElement('button'); playBtn.textContent='Play Sample';
        playBtn.onclick = ()=>playSampleForVoice(document.getElementById('langSel').value, i);
        controls.appendChild(playBtn);
        div.appendChild(info); div.appendChild(controls); wrap.appendChild(div);
      });
      // populate voice select for the currently chosen language
      populateVoiceSelectForLang(document.getElementById('langSel').value);
    }

    function speak(text, voiceIdx){
      return new Promise(r=>{
        const u = new SpeechSynthesisUtterance(text);
        const v = speechSynthesis.getVoices()[voiceIdx];
        if(v) u.voice = v;
        u.onend = ()=>setTimeout(r,50);
        speechSynthesis.speak(u);
      });
    }

    async function playSampleForVoice(code, voiceIdx){
      const sampleMap = { la: samples.latin, el: samples.greek, it: 'Ciao, come stai?', en: 'Hello, how are you?', fr: 'Bonjour, comment ça va?', de: 'Guten Tag, wie geht\'s?', es: 'Hola, ¿cómo estás?' };
      const text = sampleMap[code] || samples.latin;
      await speak(text, voiceIdx);
    }

    async function playAllVoicesForLang(code){
      const v = speechSynthesis.getVoices() || [];
      const indices = v.map((vo,i)=> matchVoiceToLang(vo, code) ? i : -1).filter(i=>i>=0);
      const sampleMap = { la: samples.latin, el: samples.greek, it: 'Ciao, come stai?', en: 'Hello, how are you?', fr: 'Bonjour, comment ça va?', de: 'Guten Tag, wie geht\'s?', es: 'Hola, ¿cómo estás?' };
      const text = sampleMap[code] || samples.latin;
      if(indices.length===0){ alert('No voices matched that language — try a different browser or OS.'); return; }
      for(const idx of indices){
        if(window._stopVoiceRun) break;
        await speak(text, idx);
        await new Promise(s=>setTimeout(s,300));
      }
    }

    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();
    document.getElementById('playVoice').onclick = ()=>{
      const sel = document.getElementById('voiceSel'); const idx = parseInt(sel.value,10);
      if(isNaN(idx) || idx<0){ alert('No voice selected for that language.'); return; }
      window._stopVoiceRun = false; playSampleForVoice(document.getElementById('langSel').value, idx).catch(()=>{});
    };
    document.getElementById('playAll').onclick = ()=>{ window._stopVoiceRun = false; playAllVoicesForLang(document.getElementById('langSel').value).catch(()=>{}); };
    document.getElementById('stopAll').onclick = ()=>{ window._stopVoiceRun = true; speechSynthesis.cancel(); };
    document.getElementById('langSel').onchange = (e)=> populateVoiceSelectForLang(e.target.value);
  </script>
</body>
</html>
